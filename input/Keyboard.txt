--@name Keyboard
--@author Xandaros

Keyboard = {
	buffer = {},
	initialized = false
}

Inputs = Inputs or {}
InputTypes = InputTypes or {}

local function initKeyboard()
	if Keyboard.initialized then
		return
	end
	Inputs[#Inputs+1] = "Keyboard"
	InputTypes[#InputTypes+1] = "WIRELINK"
	wire.adjustInputs(Inputs, InputTypes)
	Keyboard.initialized = true
end

local function queryKeyboard()
	if not Keyboard.initialized then return end
	local entries = wire.ports.Keyboard[0]
	for i=1, entries do
		Keyboard.buffer[#Keyboard.buffer+1] = wire.ports.Keyboard[i]
	end
	wire.ports.Keyboard[0] = 1
end

function Keyboard.getKey()
	initKeyboard()
	if not wire.ports.Keyboard then return nil end
	queryKeyboard()

	local buffer = Keyboard.buffer
	if #buffer > 0 then
		local ret = buffer[1]
		table.remove(buffer, 1)
		return ret
	else
		return nil
	end
end

-- vim: filetype=lua :
